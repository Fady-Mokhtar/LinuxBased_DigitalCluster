/**
 * @file Encoder.c
 * @author Ahmed Talaat
 * @brief
 * @version 0.1
 * @date 2024-05-01
 *
 * @copyright Copyright (c) 2024
 *
 */

/********************************************************************************************************/
/************************************************Includes************************************************/
/********************************************************************************************************/
#include "stm32f1xx.h"
#include "Encoder.h"


/********************************************************************************************************/
/************************************************Defines*************************************************/
/********************************************************************************************************/



/********************************************************************************************************/
/************************************************Types***************************************************/
/********************************************************************************************************/


#define ADC_LOWER_LIMIT 0


#define ADC_UPPER_LIMIT 4095


/********************************************************************************************************/
/************************************************Variables***********************************************/
/********************************************************************************************************/

ADC_HandleTypeDef ADCHandler =
{
	 .Instance = PEDAL_ADC_HANDLER,
	 .Init.ScanConvMode = ADC_SCAN_DISABLE,
	 .Init.ContinuousConvMode = ENABLE,
	 .Init.DiscontinuousConvMode = DISABLE,
	 .Init.ExternalTrigConv = ADC_SOFTWARE_START,
	 .Init.DataAlign = ADC_DATAALIGN_RIGHT,
	 .Init.NbrOfConversion = 1,
};


/********************************************************************************************************/
/*****************************************Static Functions Prototype*************************************/
/********************************************************************************************************/



/********************************************************************************************************/
/*********************************************APIs Implementation****************************************/
/********************************************************************************************************/

uint32_t Encoder_getRead(void)
{
	HAL_ADC_PollForConversion(&ADCHandler, 1);
	uint32_t ADCRead = HAL_ADC_GetValue(&ADCHandler);

    uint32_t Encoder_Read = ((ADCRead - ADC_LOWER_LIMIT) * (ENCODER_UPPER_LIMIT - ENCODER_LOWER_LIMIT)) /
                          (ADC_UPPER_LIMIT - ADC_LOWER_LIMIT) + ENCODER_LOWER_LIMIT;

	return Encoder_Read;
}
